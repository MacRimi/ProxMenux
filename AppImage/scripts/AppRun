#!/bin/bash

# ProxMenux Monitor AppImage Entry Point
# This script is executed when the AppImage is run

# Get the directory where this AppImage is mounted
APPDIR="$(dirname "$(readlink -f "${0}")")"

export PATH="${APPDIR}/usr/bin:${PATH}"
export LD_LIBRARY_PATH="${APPDIR}/usr/lib/x86_64-linux-gnu:${APPDIR}/usr/lib:${LD_LIBRARY_PATH}"
export PYTHONPATH="${APPDIR}/usr/lib/python3/dist-packages:${APPDIR}/usr/lib/python3/site-packages:${PYTHONPATH}"

# Change to the AppImage directory
cd "${APPDIR}"

# Check for translation argument
if [[ "$1" == "--translate" ]]; then
    echo "üåê Starting ProxMenux Translation Service..."
    exec python3 "${APPDIR}/usr/bin/translate_cli.py" "${@:2}"
else
    echo "üöÄ Starting ProxMenux Monitor Dashboard..."
    echo "üìä Dashboard will be available at: http://localhost:8008"
    echo "üîå API endpoints at: http://localhost:8008/api/"
    echo ""
    
    echo "üîß Hardware monitoring tools:"
    [ -x "${APPDIR}/usr/bin/ipmitool" ] && echo "  ‚úÖ ipmitool available" || echo "  ‚ö†Ô∏è  ipmitool not available"
    [ -x "${APPDIR}/usr/bin/sensors" ] && echo "  ‚úÖ sensors available" || echo "  ‚ö†Ô∏è  sensors not available"
    [ -x "${APPDIR}/usr/bin/upsc" ] && echo "  ‚úÖ upsc available" || echo "  ‚ö†Ô∏è  upsc not available"
    echo ""
    
    echo "Press Ctrl+C to stop the server"
    echo ""
    
    # Start the Flask server
    exec python3 "${APPDIR}/usr/bin/flask_server.py"
fi
